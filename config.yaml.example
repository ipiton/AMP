# Alertmanager++ Configuration Example
# This file demonstrates all available configuration options

# ============================================================================
# Deployment Profile (TN-200)
# ============================================================================
# Values: "lite" (embedded storage) or "standard" (Postgres+Redis)
profile: standard

# ============================================================================
# Storage Backend (TN-201)
# ============================================================================
storage:
  backend: postgres  # "filesystem" for Lite, "postgres" for Standard
  filesystem_path: /data/alerthistory.db  # Used in Lite mode

# ============================================================================
# Server Configuration
# ============================================================================
server:
  port: 8080
  host: 0.0.0.0
  read_timeout: 30s
  write_timeout: 30s
  idle_timeout: 120s
  graceful_shutdown_timeout: 30s

# ============================================================================
# Database Configuration (PostgreSQL)
# ============================================================================
database:
  driver: postgres
  host: localhost
  port: 5432
  database: alerthistory
  username: postgres
  password: postgres
  ssl_mode: disable
  max_connections: 25
  min_connections: 5
  max_conn_lifetime: 1h
  max_conn_idle_time: 10m
  connect_timeout: 10s
  query_timeout: 30s

# ============================================================================
# Redis Configuration (Optional)
# ============================================================================
redis:
  addr: localhost:6379
  password: ""
  db: 0
  pool_size: 10
  min_idle_conns: 5
  dial_timeout: 5s
  read_timeout: 3s
  write_timeout: 3s
  max_retries: 3
  min_retry_backoff: 8ms
  max_retry_backoff: 512ms

# ============================================================================
# LLM Configuration (Classification)
# ============================================================================
llm:
  provider: openai  # openai, anthropic, ollama
  model: gpt-4
  api_key: ${LLM_API_KEY}
  base_url: https://api.openai.com/v1
  timeout: 30s
  max_retries: 3
  temperature: 0.0
  max_tokens: 500

# ============================================================================
# Logging Configuration
# ============================================================================
log:
  level: info  # debug, info, warn, error
  format: json  # json, text
  output: stdout  # stdout, file
  file_path: /var/log/alertmanager++.log

# ============================================================================
# Cache Configuration
# ============================================================================
cache:
  enabled: true
  backend: redis  # memory, redis
  ttl: 1h
  max_size: 1000

# ============================================================================
# Distributed Lock Configuration
# ============================================================================
lock:
  enabled: true
  backend: redis  # memory, redis
  ttl: 30s

# ============================================================================
# Application Configuration
# ============================================================================
app:
  name: Alertmanager++
  version: 0.0.1
  environment: production  # development, staging, production

# ============================================================================
# Metrics Configuration
# ============================================================================
metrics:
  enabled: true
  path: /metrics
  namespace: alert_history

# ============================================================================
# Webhook Configuration
# ============================================================================
webhook:
  max_request_size: 1048576  # 1MB
  request_timeout: 30s

  rate_limiting:
    enabled: true
    per_ip_limit: 100   # requests per second per IP
    global_limit: 1000  # requests per second globally

  authentication:
    enabled: false
    type: apikey  # apikey, jwt
    api_key: ${WEBHOOK_API_KEY}
    jwt_secret: ${WEBHOOK_JWT_SECRET}

  signature:
    enabled: false
    secret: ${WEBHOOK_SIGNATURE_SECRET}

  cors:
    enabled: false
    allowed_origins: "*"
    allowed_methods: "POST,OPTIONS"
    allowed_headers: "Content-Type,Authorization"

# ============================================================================
# HTTP Client Configuration (TN-180)
# ============================================================================
http_client:
  timeout: 30s
  max_idle_conns: 100
  max_idle_conns_per_host: 10
  idle_conn_timeout: 90s
  tls_handshake_timeout: 10s
  expect_continue_timeout: 1s
  response_header_timeout: 10s
  disable_keep_alives: false
  max_response_header_bytes: 0
  write_buffer_size: 0
  read_buffer_size: 0

# ============================================================================
# Retry Configuration (Unified across all modules)
# ============================================================================
retry:
  max_attempts: 4       # Total attempts (3 retries + 1 initial)
  base_delay: 100ms     # Base delay for exponential backoff
  max_delay: 30s        # Maximum delay between retries
  multiplier: 2.0       # Backoff multiplier (2.0 = exponential)
  jitter_ratio: 0.15    # Jitter ratio (0.15 = 15% random jitter)

# ============================================================================
# Environment Variables
# ============================================================================
# The following environment variables can be used to override config values:
#
# - LLM_API_KEY: LLM provider API key
# - WEBHOOK_API_KEY: Webhook authentication API key
# - WEBHOOK_JWT_SECRET: JWT secret for webhook authentication
# - WEBHOOK_SIGNATURE_SECRET: HMAC secret for webhook signature verification
# - DATABASE_PASSWORD: Database password
# - REDIS_PASSWORD: Redis password
#
# Example:
#   export LLM_API_KEY=sk-...
#   export DATABASE_PASSWORD=secret
